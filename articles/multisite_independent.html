<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multi-Site Analysis for Independent Data Sources â€¢ patientrecordconsistency</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multi-Site Analysis for Independent Data Sources">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">patientrecordconsistency</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="external-link nav-link" href="https://ssdqa.github.io/squba/">squba Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/multisite_independent.html">Multi-Site Analysis for Independent Data Sources</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://hdl.handle.net/20.500.14642/31">PEDSpace</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ssdqa/patientrecordconsistency/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multi-Site Analysis for Independent Data Sources</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ssdqa/patientrecordconsistency/blob/main/vignettes/multisite_independent.Rmd" class="external-link"><code>vignettes/multisite_independent.Rmd</code></a></small>
      <div class="d-none name"><code>multisite_independent.Rmd</code></div>
    </div>

    
    
<p>The multi-site analyses included in this suite are intended to be
executed against data that are all stored in the same place. However,
there may be some instances where the data associated with each site is
stored in independent locations. This vignette outlines how the
multi-site analysis can be executed in these instances.</p>
<p>After following the instructions to reproduce the analysis, you will
also need to change the <code>output_function</code> column to tell the
<code>prc_output</code> function which check you executed. Reference the
table below for the labels that are associated with each check:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Check Type</th>
<th align="left">output_function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Multi Site, Exploratory, Cross-Sectional</td>
<td align="left">prc_ms_exp_cs</td>
</tr>
<tr class="even">
<td align="left">Multi Site, Exploratory, Longitudinal</td>
<td align="left">prc_ms_exp_la</td>
</tr>
<tr class="odd">
<td align="left">Multi Site, Anomaly Detection, Cross-Sectional</td>
<td align="left">prc_ms_anom_cs</td>
</tr>
<tr class="even">
<td align="left">Multi Site, Anomaly Detection, Longitudinal</td>
<td align="left">prc_ms_anom_la</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="multi-site-exploratory-analysis">Multi-Site Exploratory Analysis<a class="anchor" aria-label="anchor" href="#multi-site-exploratory-analysis"></a>
</h2>
<p>The process for the exploratory analysis is the same for both the
cross-sectional and longitudinal configurations.</p>
<p>First, execute either of the <strong>Single Site,
Exploratory</strong> analyses, configured appropriately for your study,
against each data source.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ssdqa/patientrecordconsistency" class="external-link">patientrecordconsistency</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prc_process.html">prc_process</a></span><span class="op">(</span>cohort <span class="op">=</span> <span class="va">my_cohort</span>,</span>
<span>                        multi_or_single_site <span class="op">=</span> <span class="st">'single'</span>,</span>
<span>                        anomaly_or_exploratory <span class="op">=</span> <span class="st">'exploratory'</span>,</span>
<span>                        time <span class="op">=</span> <span class="cn">T</span> <span class="op">/</span> <span class="cn">F</span>,</span>
<span>                        <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>Then, combine these results into a single table with the different
sites delineated in the <code>site</code> column.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>my_final_results <span class="ot">&lt;-</span> my_table1 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">union</span>(my_table2) ... <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">union</span>(my_table_n) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">output_function =</span> <span class="st">'{see table above}'</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multi-site-anomaly-detection-analysis">Multi-Site Anomaly Detection Analysis<a class="anchor" aria-label="anchor" href="#multi-site-anomaly-detection-analysis"></a>
</h2>
<div class="section level3">
<h3 id="cross-sectional">Cross-Sectional<a class="anchor" aria-label="anchor" href="#cross-sectional"></a>
</h3>
<p>First, execute the <strong>Single Site, <em>Anomaly Detection</em>,
Cross-Sectional</strong> analysis, configured appropriately for your
study, against each data source.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ssdqa/patientrecordconsistency" class="external-link">patientrecordconsistency</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prc_process.html">prc_process</a></span><span class="op">(</span>cohort <span class="op">=</span> <span class="va">my_cohort</span>,</span>
<span>                        multi_or_single_site <span class="op">=</span> <span class="st">'single'</span>,</span>
<span>                        anomaly_or_exploratory <span class="op">=</span> <span class="st">'anomaly'</span>,</span>
<span>                        time <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                        <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>Then, combine these results into a single table with the different
sites delineated in the <code>site</code> column.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>my_final_results <span class="ot">&lt;-</span> my_table1 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">union</span>(my_table2) ... <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">union</span>(my_table_n)</span></code></pre></div>
<p>Finally, use this combined table as input to the
<code>compute_dist_anomalies</code> and <code>detect_outliers</code>
functions, both available through the <code>squba.gen</code> package.
The <code>p_value</code> can be selected by the user.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, execute the compute_dist_anomalies function</span></span>
<span><span class="va">df_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ssdqa.github.io/squba.gen/reference/compute_dist_anomalies.html" class="external-link">compute_dist_anomalies</a></span><span class="op">(</span>df_tbl <span class="op">=</span> <span class="va">my_table</span>,</span>
<span>                                   grp_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'fu_bin'</span><span class="op">)</span>,</span>
<span>                                   var_col <span class="op">=</span> <span class="st">'jaccard_index'</span>,</span>
<span>                                   denom_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'fu_bin'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finally, use that output as input for the detect_outliers function</span></span>
<span><span class="va">df_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ssdqa.github.io/squba.gen/reference/detect_outliers.html" class="external-link">detect_outliers</a></span><span class="op">(</span>df_tbl <span class="op">=</span> <span class="va">df_start</span>,</span>
<span>                            tail_input <span class="op">=</span> <span class="st">'both'</span>,</span>
<span>                            p_input <span class="op">=</span> <span class="va">p_value</span>,</span>
<span>                            column_analysis <span class="op">=</span> <span class="st">'jaccard_index'</span>,</span>
<span>                            column_variable <span class="op">=</span> <span class="st">'fu_bin'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>output_function <span class="op">=</span> <span class="st">'{see table above}'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="longitudinal">Longitudinal<a class="anchor" aria-label="anchor" href="#longitudinal"></a>
</h3>
<p>Start by executing the same steps as the exploratory analysis. Then,
apply some additional formatting (below) to the final combined table and
pass it into the <code>ms_anom_euclidean</code> function, available
through the <code>squba.gen</code> package.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Additional formatting for the table</span></span>
<span><span class="va">event_categorization</span> <span class="op">&lt;-</span> <span class="va">prc_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">uncount</span><span class="op">(</span><span class="va">pt_ct</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>stat_type <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">event_a_num</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">event_b_num</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'Neither Event'</span>,</span>
<span>                               <span class="va">event_a_num</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">event_b_num</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'Event B Only'</span>,</span>
<span>                               <span class="va">event_a_num</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">event_b_num</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'Event A Only'</span>,</span>
<span>                               <span class="va">event_a_num</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">event_b_num</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">'Both Events'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">site</span>, <span class="va">time_start</span>, <span class="va">time_increment</span>, </span>
<span>           <span class="va">event_a_name</span>, <span class="va">event_b_name</span>, <span class="va">total_pts</span>, <span class="va">stat_type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>stat_ct <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            prop_event <span class="op">=</span> <span class="va">stat_ct</span> <span class="op">/</span> <span class="va">total_pts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Apply Euclidean distance computation</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ssdqa.github.io/squba.gen/reference/ms_anom_euclidean.html" class="external-link">ms_anom_euclidean</a></span><span class="op">(</span>fot_input_tbl <span class="op">=</span> <span class="va">event_categorization</span>,</span>
<span>                        grp_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'site'</span>, <span class="st">'stat_type'</span><span class="op">)</span>,</span>
<span>                        var_col <span class="op">=</span> <span class="st">'prop_event'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hanieh Razzaghi, Kaleigh Wieand, Kimberley Dickinson, Charles Bailey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
